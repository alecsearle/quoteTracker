<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link rel="stylesheet" href="style.css" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/vuetify@3.6.11/dist/vuetify.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/vuetify@3.6.11/dist/vuetify.min.js"></script>
    <title>Quote Tracker</title>
  </head>
  <body>
    <div id="app">
      <v-app>
        <v-main>
          <div v-if="currentPage === 'loading'"></div>
          <!-- LOGIN -->
          <div v-if="currentPage === 'login'" class="login">
            <v-form fast-fail @submit.prevent="loginUser()">
              <h3>Login</h3>
              <div class="input-container">
                <v-text-field
                  v-model="user.email"
                  :rules="rules"
                  label="Email"
                ></v-text-field>
              </div>
              <div class="input-container">
                <v-text-field
                  v-model="user.password"
                  :rules="rules"
                  label="Password"
                  type="password"
                ></v-text-field>
              </div>
              <div class="submit">
                <v-btn
                  variant="tonal"
                  rounded="lg"
                  v-ripple
                  size="x-large"
                  type="submit"
                  >Login</v-btn
                >
              </div>
              <div class="gap"></div>
              <div class="buttons">
                <p>
                  <span @click="setPage('findQuote')">
                    <v-btn variant="outlined" rounded="lg" v-ripple
                      >View Quote</v-btn
                    ></span
                  >
                </p>
                <p>
                  <span @click="setPage('register')"
                    ><v-btn variant="outlined" rounded="lg" v-ripple
                      >Register Buisness</v-btn
                    ></span
                  >
                </p>
              </div>
            </v-form>
          </div>

          <!-- REGISTER -->
          <div v-if="currentPage === 'register'">
            <v-form fast-fail @submit.prevent="registerUser()">
              <h3>Register</h3>
              <div class="input-container">
                <v-text-field
                  v-model="user.companyName"
                  :rules="companyNameRules"
                  label="Company Name"
                ></v-text-field>
              </div>
              <div class="input-container">
                <v-text-field
                  v-model="user.email"
                  :rules="rules"
                  label="Email"
                ></v-text-field>
              </div>
              <div class="input-container">
                <v-text-field
                  v-model="user.password"
                  :rules="rules"
                  label="Password"
                  type="password"
                ></v-text-field>
              </div>
              <div class="submit">
                <v-btn
                  variant="tonal"
                  rounded="lg"
                  v-ripple
                  size="x-large"
                  type="submit"
                  >Register</v-btn
                >
              </div>
              <div class="gap"></div>
              <div class="buttons">
                <p>
                  <span @click="setPage('findQuote')">
                    <v-btn variant="outlined" rounded="lg" v-ripple
                      >View Quote</v-btn
                    ></span
                  >
                </p>
                <p>
                  <span @click="setPage('login')"
                    ><v-btn variant="outlined" rounded="lg" v-ripple
                      >Login</v-btn
                    ></span
                  >
                </p>
              </div>
            </v-form>
          </div>

          <!-- FIND QUOTE -->
          <div v-if="currentPage === 'findQuote'">
            <v-form fast-fail @submit.prevent="getQuote(quotes._id)">
              <h3>Find a Quote</h3>
              <div class="input-container">
                <v-text-field
                  v-model="quotes._id"
                  :rules="rules"
                  label="Quote Number"
                ></v-text-field>
              </div>
              <div class="submit">
                <v-btn
                  variant="tonal"
                  rounded="lg"
                  v-ripple
                  size="x-large"
                  type="submit"
                  >Find Quote</v-btn
                >
              </div>
              <div class="gap"></div>
              <div class="buttons">
                <p>
                  <span @click="setPage('login')"
                    ><v-btn variant="outlined" rounded="lg" v-ripple
                      >Back</v-btn
                    ></span
                  >
                </p>
              </div>
            </v-form>
          </div>

          <!-- CUSTOMER QUOTE -->
          <div v-if="currentPage === 'customerQuote'" class="customer-quote">
            <h1>{{quotes._id}}</h1>
            <h3>{{currentQuote.title}}</h3>
            <div class="customer-information">
              <h4>Customer Information:</h4>
              <p>{{currentQuote.customer.name}}</p>
              <p>{{currentQuote.customer.email}}</p>
              <p>{{currentQuote.customer.phone}}</p>
              <p>{{currentQuote.customer.address}}</p>
            </div>

            <p>{{currentQuote.description}}</p>
            <p>{{currentQuote.status}}</p>
            <p>{{currentQuote.createdAt}}</p>
            <div v-for="item in currentQuote.items">
              <h4>{{item.name}}</h4>
              <p>{{item.description}}</p>
              <p>{{item.quantity}}</p>
              <p>{{item.unitPrice}}</p>
              <p>{{item.totalPrice}}</p>
            </div>
            <h1>${{currentQuote.totalAmount}}</h1>
            <p>{{currentQuote.comments}}</p>
          </div>

          <!-- NAV BAR -->
          <nav
            v-if="currentPage !== 'login' && currentPage !=='register' && currentPage !=='findQuote' && currentPage !== 'customerQuote'"
          >
            <h1 @click="setPage('home')">QuoteTracker</h1>
            <p v-if="currentUser">welcome, {{currentUser.companyName}}</p>
            <div class="nav-selectors">
              <v-btn
                @click="setPage('home')"
                class="nav-button"
                variant="tonal"
                rounded="lg"
                v-ripple
                size="x-large"
                >HOME</v-btn
              >
              <v-btn
                @click="setPage('quotes')"
                class="nav-button"
                variant="tonal"
                rounded="lg"
                v-ripple
                size="x-large"
                >QUOTES</v-btn
              >
              <v-btn
                @click="setPage('stats')"
                class="nav-button"
                variant="tonal"
                rounded="lg"
                v-ripple
                size="x-large"
                >COMPANY STATS</v-btn
              >
            </div>
            <v-btn
              variant="tonal"
              rounded="lg"
              v-ripple
              size="x-large"
              class="nav-button"
              @click="deleteSession()"
              >LOGOUT</v-btn
            >
            <!-- <button
                v-if="currentUser"
                @click="deleteSession()"
                >
                Logout
              </button> -->
          </nav>

          <!-- HOME PAGE -->
          <div v-if="currentPage === 'home'">
            <div @click="setPage('newQuote');editOff();" class="new-quote">
              <v-btn variant="outlined" rounded="lg" size="x-large" v-ripple
                >New Quote +</v-btn
              >
            </div>
            <h3>Recent Quotes</h3>
            <div class="thumbnails">
              <div v-for="quote in quotes.slice(0,3)">
                <div
                  v-if="quote.owner === currentUser.companyID"
                  class="quote-thumbnail"
                >
                  <h5>{{quote._id}}</h5>
                  <h3>{{quote.title}}</h3>
                  <p>{{quote.description}}</p>
                  <p>{{quote.customer.name}}</p>
                  <p>{{quote.status}}</p>
                  <p>{{quote.createdAt}}</p>
                  <h4>${{quote.totalAmount}}</h4>
                  <p>{{quote.comments}}</p>

                  <div class="edit_delete">
                    <button @click.stop="editQuote(quote)">Edit</button>
                    <button
                      @click.stop="deleteQuote(quote._id)"
                      id="delete_button"
                    >
                      Delete
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- QUOTES PAGE -->
          <div v-if="currentPage === 'quotes'">
            <h1>ALL QUOTES</h1>
            <div @click="setPage('newQuote')" class="new-quote">
              <v-btn variant="outlined" rounded="lg" size="x-large" v-ripple
                >New Quote +</v-btn
              >
            </div>
            <div id="search-bar">
              <input
                type="text"
                placeholder="Search..."
                v-model="searchInput"
              />
              <p id="clear-search">X</p>
            </div>
            <div class="thumbnails">
              <div v-for="quote in quotes">
                <div
                  v-if="quote.owner === currentUser.companyID"
                  class="quote-thumbnail"
                >
                  <h5>{{quote._id}}</h5>
                  <h3>{{quote.title}}</h3>
                  <p>{{quote.description}}</p>
                  <p>{{quote.customer.name}}</p>
                  <p>{{quote.status}}</p>
                  <p>{{quote.createdAt}}</p>
                  <h4>${{quote.totalAmount}}</h4>
                  <p>{{quote.comments}}</p>

                  <div class="edit_delete">
                    <button @click.stop="editQuote(quote);setPage('editPage');">Edit</button>
                    <button
                      @click.stop="deleteQuote(quote._id)"
                      id="delete_button"
                    >
                      Delete
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- NEW QUOTE -->
          <div v-if="currentPage === 'newQuote'">
            <div class="form">
              <v-form fast-fail @submit.prevent="createQuote()">
                <h3>New Quote</h3>
                <div class="input-container">
                  <v-text-field
                    v-model="newQuote.customer.name"
                    :rules="rules"
                    label="Customer Name"
                  ></v-text-field>
                </div>
                <div class="input-container">
                  <v-text-field
                    v-model="newQuote.customer.email"
                    :rules="rules"
                    label="Customer Email"
                  ></v-text-field>
                </div>
                <div class="input-container">
                  <v-text-field
                    v-model="newQuote.customer.phone"
                    :rules="rules"
                    label="Customer Phone Number"
                  ></v-text-field>
                </div>
                <div class="input-container">
                  <v-text-field
                    v-model="newQuote.customer.address"
                    :rules="rules"
                    label="Customer Address"
                  ></v-text-field>
                </div>
                <div class="input-container">
                  <v-text-field
                    v-model="newQuote.title"
                    :rules="rules"
                    label="Quote Title"
                  ></v-text-field>
                </div>
                <div class="input-container">
                  <v-text-field
                    v-model="newQuote.description"
                    :rules="rules"
                    label="description"
                  ></v-text-field>
                </div>
                <!-- <div class="input-container">
                  <v-text-field
                    v-model="newQuote.createdAt"
                    :rules="rules"
                    label="created at"
                  ></v-text-field>
                </div> -->
                <!-- items in quote -->
                <div class="input-container">
                  <div v-for="(item, index) in newItems">
                    <p>Item</p>
                    <div class="item-container">
                      <v-text-field
                        v-model="item.name"
                        :rules="rules"
                        label="title"
                      ></v-text-field>
                    </div>
                    <div class="item-container">
                      <v-text-field
                        v-model="item.description"
                        :rules="rules"
                        label="description"
                      ></v-text-field>
                    </div>
                    <div class="item-container">
                      <v-text-field
                        v-model="item.quantity"
                        :rules="rules"
                        label="quantity"
                      ></v-text-field>
                    </div>
                    <div class="item-container">
                      <v-text-field
                        v-model="item.unitPrice"
                        :rules="rules"
                        label="Unit Price"
                      ></v-text-field>
                    </div>
                    <v-btn @click="deleteItem(index)">X</v-btn>
                  </div>
                  <v-btn @click="createItem()">Add Item</v-btn>
                </div>
                <div class="input-container">
                  <v-text-field
                    v-model="newQuote.comments"
                    :rules="rules"
                    label="comment"
                  ></v-text-field>
                </div>
                <div class="input-container">
                  <v-text-field
                    v-model="newQuote.totalAmount"
                    :rules="rules"
                    label="total"
                  ></v-text-field>
                </div>
                <div class="submit">
                  <v-btn
                    variant="tonal"
                    rounded="lg"
                    v-ripple
                    size="x-large"
                    type="submit"
                    >Submit Quote</v-btn
                  >
                </div>
                <div class="gap"></div>
                <div class="buttons"></div>
              </v-form>
            </div>
          </div>

            <!-- Edit Quotes -->
 <!-- NEW QUOTE -->
 <div v-if="currentPage === 'editPage'">
  <div class="form">
    <v-form fast-fail @submit.prevent="saveQuote()">
      <h3>Edit Quote</h3>
      <div class="input-container">
        <v-text-field
          v-model="newQuote.customer.name"
          :rules="rules"
          label="Customer Name"
        ></v-text-field>
      </div>
      <div class="input-container">
        <v-text-field
          v-model="newQuote.customer.email"
          :rules="rules"
          label="Customer Email"
        ></v-text-field>
      </div>
      <div class="input-container">
        <v-text-field
          v-model="newQuote.customer.phone"
          :rules="rules"
          label="Customer Phone Number"
        ></v-text-field>
      </div>
      <div class="input-container">
        <v-text-field
          v-model="newQuote.customer.address"
          :rules="rules"
          label="Customer Address"
        ></v-text-field>
      </div>
      <div class="input-container">
        <v-text-field
          v-model="newQuote.title"
          :rules="rules"
          label="Quote Title"
        ></v-text-field>
      </div>
      <div class="input-container">
        <v-text-field
          v-model="newQuote.description"
          :rules="rules"
          label="description"
        ></v-text-field>
      </div>
      <!-- <div class="input-container">
        <v-text-field
          v-model="newQuote.createdAt"
          :rules="rules"
          label="created at"
        ></v-text-field>
      </div> -->
      <!-- items in quote -->
      <div class="input-container">
        <div v-for="(item, index) in newItems">
          <p>Item</p>
          <div class="item-container">
            <v-text-field
              v-model="item.name"
              :rules="rules"
              label="title"
            ></v-text-field>
          </div>
          <div class="item-container">
            <v-text-field
              v-model="item.description"
              :rules="rules"
              label="description"
            ></v-text-field>
          </div>
          <div class="item-container">
            <v-text-field
              v-model="item.quantity"
              :rules="rules"
              label="quantity"
            ></v-text-field>
          </div>
          <div class="item-container">
            <v-text-field
              v-model="item.unitPrice"
              :rules="rules"
              label="Unit Price"
            ></v-text-field>
          </div>
          <v-btn @click="deleteItem(index)">X</v-btn>
        </div>
        <v-btn @click="createItem()">Add Item</v-btn>
      </div>
      <div class="input-container">
        <v-text-field
          v-model="newQuote.comments"
          :rules="rules"
          label="comment"
        ></v-text-field>
      </div>
      <div class="input-container">
        <v-text-field
          v-model="newQuote.totalAmount"
          :rules="rules"
          label="total"
        ></v-text-field>
      </div>
      <div class="submit">
        <v-btn
          variant="tonal"
          rounded="lg"
          v-ripple
          size="x-large"
          type="submit"
          >Save Quote</v-btn
        >
      </div>

          <!-- COMPANY STATS -->
          <div v-if="currentPage === 'stats'">
            <h1>COMPANY STATS</h1>
          </div>
        </v-main>
      </v-app>
    </div>

    <script src="app.js"></script>
  </body>
</html>
